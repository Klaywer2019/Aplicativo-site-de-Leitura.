<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Invent√°rio Real - Reino Celeste</title>
    <style>
        body { background: #0a0a0a; color: white; font-family: 'Segoe UI', sans-serif; padding: 20px; }
        .grid-inventario { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); 
            gap: 20px; 
            margin-top: 20px;
        }
        .card-obra { 
            background: #1e1e1e; 
            border: 2px solid #6a1b9a; 
            border-radius: 15px; 
            padding: 15px; 
            transition: 0.3s;
        }
        .card-obra:hover { transform: scale(1.02); box-shadow: 0 0 15px #6a1b9a; }
        .autor { color: #55efc4; font-size: 0.9rem; margin-bottom: 10px; }
        iframe { 
            width: 100%; 
            height: 150px; 
            background: white; 
            border: none; 
            border-radius: 8px; 
        }
        .btn-voltar { background: #444; color: white; padding: 10px; border: none; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>

    <button class="btn-voltar" onclick="window.location.href='index.html'">‚¨Ö Voltar para a Home</button>
    <h1>üíé Invent√°rio de Obras Forjadas</h1>
    <p>Aqui repousam os c√≥digos selados pelo Or√°culo C++.</p>

    <div id="lista-obras" class="grid-inventario">
        <p>Carregando rel√≠quias do banco SQL...</p>
    </div>

    <script>
        async function carregarInventario() {
            try {
                // Chama a rota que a gente criou no app.py
                const response = await fetch('http://127.0.0.1:5000/listar_tesouros');
                const obras = await response.json();
                
                const lista = document.getElementById('lista-obras');
                lista.innerHTML = ''; // Limpa o texto de carregando

                if (obras.length === 0) {
                    lista.innerHTML = "<p>O invent√°rio est√° vazio. V√° at√© a Forja criar algo!</p>";
                    return;
                }

                obras.forEach(obra => {
                    const card = document.createElement('div');
                    card.className = 'card-obra';
                    
                    // Tratando o texto que veio (HTML e CSS juntos)
                    const partes = obra.codigo.split(' | CSS: ');
                    const htmlContent = partes[0].replace('HTML: ', '');
                    const cssContent = partes[1] || '';

                    card.innerHTML = `
                        <div class="autor">‚öíÔ∏è Mestre: ${obra.usuario}</div>
                        <iframe srcdoc="${htmlContent}<style>${cssContent}</style>"></iframe>
                        <p style="font-size: 0.7rem; color: #aaa; margin-top: 10px;">Forjado em: ${obra.data}</p>
                    `;
                    lista.appendChild(card);
                });
            } catch (error) {
                console.error("Erro:", error);
                document.getElementById('lista-obras').innerHTML = "<p style='color:red;'>‚ö†Ô∏è Erro ao conectar com o Motor Python!</p>";
            }
        }

        // Executa a fun√ß√£o assim que a p√°gina abre
        window.onload = carregarInventario;
    </script>
</body>
</html>
